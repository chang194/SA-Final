<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Hotel info</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="static/css/navbar.css">
  <link rel="stylesheet" type="text/css" href="static/css/button.css">
  <script src="static/js/login.js"></script>
  <style>

  </style>
</head>

<body>
  <nav class="navbar bg-white navbar-white p-1 navbar-expand-lg">
    <div class="container-fluid">
      <a href="index.html" class="navbar-brand">
        <img src="static/img/LOGO.png" alt="logo">
      </a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a href="" class="nav-link">旅遊社群</a>
          </li>
          <li class="nav-item" id="myOrdersNavItem" style="display: none;">
            <a href="myorder.html" class="nav-link">我的訂單</a>
          </li>
          <li class="nav-item" id="shoppingCartNavItem" style="display: none;">
            <a href="shoppingcart.html" class="nav-link">購物車</a>
        </ul>
        <div class="dropdown">
          <button class="btn btn-primary dropdown-toggle" type="button" id="memberDropdown" data-bs-toggle="dropdown"
            aria-expanded="false">
            <img src="static/img/會員.png" alt="會員圖標">
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="memberDropdown">
            ${isLoggedIn ?
            `<li><a class="dropdown-item" href="member.html">會員資料</a></li>
            <li><button class="dropdown-item" onclick="logout()">登出</button></li>` :
            `<li><a class="dropdown-item" href="login.html">登入</a></li>`}
          </ul>
        </div>
        </ul>
      </div>
  </nav>

  <div class="container mt-5">
    <div class="row">
      <div class="col-lg-8">
        <h1 id="hotelname">${hotel_name}</h1>
        <p id="location">${location}</p>
        <p id="hotelphone">旅店電話</p>
        <p id="intro">${intro}</p>
      </div>
      <div class="col-lg-4">
        <img src="" alt="" id="hotelimage" style="display: grid;">
      </div>
    </div>
    <div class="row">
      <h2>房型介紹</h2>
      <div class="row g-4 row-gap" id=cardContainer>
        <div class="col-md-6">
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
  
  const cardContainer = document.getElementById('cardContainer');
  
	  document.addEventListener('DOMContentLoaded', function() {
	      getData();
	      getRoomData();
	  }); 
	  
	  function displayNotification(message) {
	      alert(message);
	  }
	  
	  function getData(){
		  var id = hotel_id;
		  var url = `api/hotel.do?id=${encodeURIComponent(id)}`;
		  fetch(url, {
	          method: 'GET',
	          headers: {
	              'Content-Type': 'application/json',
	          },
	      })
	          .then(response => {
	              if (!response.ok) {
	                  throw new Error('Network response was not ok.');
	              }
	              return response.json();
	          })
	          .then(query => {
	              console.log('Response from server:', query);
	              var dataArray = query.response.data;

	                 // 檢查 data 是否為陣列且有資料
	                 	if (Array.isArray(dataArray) && dataArray.length > 0) {  
		                   // 從第一筆資料中取得 email
		                  	var firstData = dataArray[0];
		                  	var hotelname = firstData.hotelname;
		                  	var location = "旅店地址 : " + firstData.location;
		                  	var intro = "旅店簡介 : " + firstData.intro;
	
		                   // 將 email 資料設定到你的 HTML 元素
		                   document.getElementById('hotelname').innerText = hotelname;
		                   document.getElementById('location').innerText = location;
		                   document.getElementById('intro').innerText = intro;
	                 	}
	      	    	
	          })
	          .catch(error => {
	              displayNotification('資料取得失敗！');
	          });
	  }
	  
	  function getRoomData(){
		  var id = hotel_id;
		  var room_id = -1;
		  var url = `api/room.do?hotel_id=${encodeURIComponent(id)}&room_id=${encodeURIComponent(room_id)}`;
		  fetch(url, {
	          method: 'GET',
	          headers: {
	              'Content-Type': 'application/json',
	          },
	      })
	          .then(response => {
	              if (!response.ok) {
	                  throw new Error('Network response was not ok.');
	              }
	              return response.json();
	          })
	          .then(query => {
	              console.log('Response from server:', query);

	              // 'data' 是包含所有旅店資料的 JSON 數組
	              console.log('Room Data:', query.response.data);
	              var rooms = query.response.data
	              
	              
	           	// 创建一个新的行容器
	              let currentRow = createRow();
	              
	              for (var i = 0; i < rooms.length; i++) {
	            	  var room = rooms[i].data;
	            	  console.log('Rooms:', room);
	            	  for(var j = 0;j < room.length;j++){
	            		  var roomtype = room[j].room_type;
		                  var maxcapacity = room[j].max_capacity;
		                  var price = room[j].room_price;
		                  console.log("Room type:", roomtype);
		                  console.log("Max:", maxcapacity);
		                  console.log("Price:",price);

		                  // 如果当前行已经有了三个卡片，创建新的行容器
		                  if (currentRow.children.length === 3) {
		                      cardContainer.appendChild(currentRow);
		                      currentRow = createRow(); // 创建新的行
		                  }

		                  // 创建旅店卡片
		                  const card = createRoomCard(roomtype, maxcapacity, price);

		                  // 将卡片添加到当前行容器中
		                  currentRow.appendChild(card);
	            	  }
	            	  
	              }

	              // 确保最后一行也被添加到容器中
	              cardContainer.appendChild(currentRow);
	      	    	
	          })
	          .catch(error => {
	              displayNotification('資料取得失敗！');
	          });
	  }
	  
	  function createRoomCard(roomtype, maxcapacity, price) {
	      const cardElement = document.createElement('div');
	      var max = "最大人數 : " + maxcapacity;
	      var roomprice = "價格 : " + price;
	      var img = "static/img/狗6.jpg";
	      
	      // 设置卡片容器的固定宽度和高度
	      cardElement.style.width = '370px';
	      cardElement.style.height = '460px';

	      // 设置盒子模型计算方式为 border-box
	      cardElement.style.boxSizing = 'border-box';

	      // 使用 Flexbox 布局
	   	  cardElement.style.flex = '0 0 auto'; // 设置为1，表示每个卡片的宽度相等，但不拉伸
	      cardElement.style.flexDirection = 'column'; // 垂直方向排列
	      
	      cardElement.className = 'col-lg';
	      cardElement.innerHTML = `
	          <div class="card shadow-lg" style="height: 100%;">
	              <img src="${img}" alt="" class="card-img-top">
	              <div class="card-body" style="height: 100%;">
	                  <div style="height: 100%; display: flex; flex-direction: column; justify-content: space-between;">
	                      <h3 class="card-title">${roomtype}</h3>
	                      <p class="card-text">${max}</p>
	                      <p class="card-text">${roomprice}</p>
	                      <label for="datepicker">選擇日期:</label>
	                      <input type="date" class="form-control" id="date_range" required>
	                      <a class="btn btn-primary" onclick="addToCart()">加入購物車</a>
	                  </div>
	              </div>
	          </div>
	      `;

	      return cardElement;
	    }
	  
	  function createRow() {
		  const row = document.createElement('div');
		  row.className = 'row g-4 row-gap';
		  
			// 使用 Flexbox 布局
		    row.style.display = 'flex';
		    row.style.flexDirection = 'row';
		    row.style.flexWrap = 'wrap';
		    row.style.alignItems = 'center'; // 垂直方向居中
		    row.style.marginLeft = '-10px'; // 负 margin 抵消默认间距
		    row.style.marginRight = '-10px'; // 负 margin 抵消默认间距
		    
		  return row;
		}
	  
	  $(function() {
		  $('#date_range').daterangepicker({
		    opens: 'left', // 可以設定日曆的顯示位置
		    startDate: moment().subtract(1, 'days'), // 預設開始日期（在這裡是一天前）
		    endDate: moment(), // 預設結束日期（在這裡是今天）
		    ranges: {
		      '今天': [moment(), moment()],
		      '昨天': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
		      '過去7天': [moment().subtract(6, 'days'), moment()],
		      '過去30天': [moment().subtract(29, 'days'), moment()],
		      '本月': [moment().startOf('month'), moment().endOf('month')],
		      '上個月': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
		    }
		  }, function(start, end, label) {
		    // 選擇日期後的回調函數
		    console.log('開始日期: ' + start.format('YYYY-MM-DD'));
		    console.log('結束日期: ' + end.format('YYYY-MM-DD'));
		  });
		});
	  function addToCart() {
		    // 獲取選擇的日期
		    var selectedDate = document.getElementById('bth').value;

		    // 假設有一個用於顯示購物車內容的元素，這裡是示例，請根據實際情況進行修改
		    var cartContentElement = document.getElementById('cart-content');

		    // 將選擇的日期信息添加到購物車內容中
		    var cartItem = document.createElement('div');
		    cartItem.innerHTML = `Selected Date: ${selectedDate}`;
		    cartContentElement.appendChild(cartItem);
		}




    var isLoggedIn = true; // Default login status
    var cart = JSON.parse(localStorage.getItem('cart')) || []; // Get cart from localStorage

    
  //獲取 URL 中的查詢參數
    const urlParams = new URLSearchParams(window.location.search);
    const hotel_id = urlParams.get('hotel_id');
    console.log("hotel",hotel_id);
    
  
    var logoLink = document.getElementById('logoLink');
    var user_type = localStorage.getItem('user_type');
    // 修改链接的 href 属性，传递 loginStatus 参数
    if(user_type == 'customer'){
   	 logoLink.href = 'index.html?login_status=' + 'true';
    }


  </script>

</body>

</html>
